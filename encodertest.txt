/* Pro Micro Test Code
   by: Nathan Seidle
   modified by: Jim Lindblom
   SparkFun Electronics
   date: September 16, 2013
   license: Public Domain - please use this code however you'd like.
   It's provided as a learning tool.

   This code is provided to show how to control the SparkFun
   ProMicro's TX and RX LEDs within a sketch. It also serves
   to explain the difference between Serial.print() and
   Serial1.print().
*/

int RXLED = 17;  // The RX LED has a defined Arduino pin
// Note: The TX LED was not so lucky, we'll need to use pre-defined
// macros (TXLED1, TXLED0) to control that.
// (We could use the same macros for the RX LED too -- RXLED1,
//  and RXLED0.)

#define CLK 14
#define DT  16

int currentStateCLK;
int previousStateCLK;

int counter;

void setup()
{
  pinMode(RXLED, OUTPUT);  // Set RX LED as an output
  // TX LED is set as an output behind the scenes

  Serial.begin(9600); //This pipes to the serial monitor
  Serial.println("Initialize Serial Monitor");

  Serial1.begin(9600); //This is the UART, pipes to sensors attached to board
  Serial1.println("Initialize Serial Hardware UART Pins");

  pinMode(CLK, INPUT);
  pinMode(DT, INPUT);

  previousStateCLK = currentStateCLK = digitalRead(CLK);  
  counter = 0;
}

void loop()
{
  currentStateCLK = digitalRead(CLK);

  if(currentStateCLK > 0 && currentStateCLK != previousStateCLK)
  {
    int dt = digitalRead(DT);
    if( dt != currentStateCLK)
    {a
      digitalWrite(RXLED, LOW);
      TXLED0;
      counter = counter + 1; 
    }
    else
    {
      digitalWrite(RXLED, HIGH);
      TXLED1;
      counter = counter - 1;
    }
    delay(10);
    Serial.print(currentStateCLK); Serial.print(":"); Serial.print(dt); Serial.print("---"); 
    Serial.println(counter);
  }
  else
  {
    digitalWrite(RXLED, HIGH);
    TXLED0;
  }

  previousStateCLK = currentStateCLK;
}